@page
@model zerix_fe_dev.Pages.Scheduler.admin_view.ReportsModel
@{
    Layout = "_Scheduler";
    ViewData["Title"] = "Reports";
    ViewData["User"] = "Admin";
}

@await Html.PartialAsync("../_Styles")

@await Html.PartialAsync("../admin_view/_Styles")

@await Html.PartialAsync("../user_view/_Navigation")

@await Html.PartialAsync("../user_view/_MobileSidebar")

<div class="container px-4 my-3 pt-md-3 pt-3 reports-page">
    <!-- Mobile Header with Back and Title -->
    <div class="reports-mobile-header d-md-none">
        <a href="javascript:history.back()" class="reports-back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </a>
        <h2 class="reports-mobile-title">Reports</h2>
    </div>

    <!-- Desktop Go Back Link -->
    <a href="javascript:history.back()" class="reports-go-back d-none d-md-inline-flex">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Go Back
    </a>

    <!-- Desktop Reports Title -->
    <h2 class="reports-title d-none d-md-block">Reports</h2>

    <!-- Mobile Filter Button -->
    <div class="reports-mobile-filter-btn-wrapper d-md-none">
        <button type="button" class="reports-mobile-filter-btn" data-bs-toggle="modal" data-bs-target="#reportsFilterModal">
            Filter
        </button>
    </div>

    <!-- Mobile Filter Tags Row -->
    <div class="reports-mobile-filter-tags d-md-none">
        <div class="reports-filter-tag-group">
            <span class="reports-filter-tag-label">Appointment Type</span>
            <span class="reports-filter-tag-value" id="mobileFilterTypeTag">All</span>
        </div>
        <div class="reports-filter-tag-group">
            <span class="reports-filter-tag-label">Status</span>
            <span class="reports-filter-tag-value" id="mobileFilterStatusTag">Cancelled</span>
        </div>
        <div class="reports-filter-tag-group">
            <span class="reports-filter-tag-label">Date Range</span>
            <span class="reports-filter-tag-value" id="mobileFilterDateTag">09/11/2024 - 10/25/2024</span>
        </div>
    </div>

    <!-- Reports Main Layout -->
    <div class="reports-main-layout">
        <!-- Left Filters Panel -->
        <div class="reports-filters-panel">
            <!-- Date Range -->
            <div class="reports-filter-group">
                <label class="reports-filter-label">Date Range</label>
                <div class="reports-date-input-wrapper">
                    <input type="text" class="form-control reports-date-input" id="reportDateFrom" placeholder="From">
                    <svg class="reports-calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
                <div class="reports-date-input-wrapper">
                    <input type="text" class="form-control reports-date-input" id="reportDateTo" placeholder="To">
                    <svg class="reports-calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
            </div>

            <!-- Appointment Type -->
            <div class="reports-filter-group">
                <label class="reports-filter-label">Appointment Type</label>
                <div class="reports-select-wrapper reports-select-no-dot">
                    <select class="form-select reports-select" id="reportAppointmentType">
                        <option value="all" selected>All</option>
                        <option value="consultation">Consultation</option>
                        <option value="medical">Medical Appointment</option>
                    </select>
                </div>
            </div>

            <!-- Status -->
            <div class="reports-filter-group">
                <label class="reports-filter-label">Status</label>
                <div class="reports-select-wrapper">
                    <select class="form-select reports-select reports-status-select" id="reportStatus">
                        <option value="cancelled" selected>Cancelled</option>
                        <option value="booked">Booked</option>
                        <option value="completed">Completed</option>
                        <option value="rescheduled">Rescheduled</option>
                    </select>
                </div>
            </div>

            <!-- Report Type Radio Buttons -->
            <div class="reports-filter-group reports-radio-group">
                <div class="reports-radio-item">
                    <input type="radio" name="reportType" id="summaryReport" value="summary" onchange="toggleFormQuestionsByReportType()">
                    <label for="summaryReport">Summary Report</label>
                </div>
                <div class="reports-radio-item">
                    <input type="radio" name="reportType" id="detailedReport" value="detailed" checked onchange="toggleFormQuestionsByReportType()">
                    <label for="detailedReport">Detailed Report</label>
                </div>
            </div>

            <!-- Generate Button -->
            <button class="btn reports-generate-btn" onclick="generateReport()">Generate</button>

            <!-- Export to CSV Link -->
            <a href="#" class="reports-export-link" onclick="exportToCSV()">Export to CSV</a>
        </div>

        <!-- Right Results Panel -->
        <div class="reports-results-panel">
            <!-- Top Filters Row -->
            <div class="reports-top-filters">
                <div class="reports-top-filter-group">
                    <label class="reports-filter-label">Appointment Type</label>
                    <div class="reports-top-filter-value">All</div>
                </div>
                <div class="reports-top-filter-group">
                    <label class="reports-filter-label">Status</label>
                    <div class="reports-top-filter-value">Cancelled</div>
                </div>
                <div class="reports-top-filter-group reports-date-range-display">
                    <label class="reports-filter-label">Date Range</label>
                    <div class="reports-top-filter-value">09/11/2024 - 10/25/2024</div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="reports-table-container">
                <table class="reports-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Time</th>
                            <th>Client</th>
                            <th>Status</th>
                            <th>Payment</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Row 1 -->
                        <tr class="reports-row" data-expanded="true">
                            <td>01-01-25</td>
                            <td>Consultation</td>
                            <td>10:00 -11:00 am</td>
                            <td>Juan Dela Cruz</td>
                            <td><span class="reports-status-badge cancelled"><span class="status-dot"></span> Cancelled</span></td>
                            <td>P 2,000.00</td>
                        </tr>
                        <tr class="reports-form-questions-row">
                            <td colspan="6">
                                <div class="reports-form-questions">
                                    <div class="reports-form-questions-header" onclick="toggleFormQuestions(this)">
                                        <span>Form Questions</span>
                                        <svg class="reports-chevron-up" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="reports-form-questions-content">
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">How old are you?</div>
                                            <div class="reports-question-answer">25</div>
                                        </div>
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">Do you have any allergies to medications?</div>
                                            <div class="reports-question-answer">No.</div>
                                        </div>
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">Do you have any family history of any conditions?</div>
                                            <div class="reports-question-answer">Tuberculosis</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 2 -->
                        <tr class="reports-row">
                            <td>01-01-25</td>
                            <td>Medical Appointment</td>
                            <td>10:00 -11:00 am</td>
                            <td>Juan Dela Cruz</td>
                            <td><span class="reports-status-badge cancelled"><span class="status-dot"></span> Cancelled</span></td>
                            <td>P 2,000.00</td>
                        </tr>
                        <tr class="reports-form-questions-row collapsed">
                            <td colspan="6">
                                <div class="reports-form-questions">
                                    <div class="reports-form-questions-header" onclick="toggleFormQuestions(this)">
                                        <span>Form Questions</span>
                                        <svg class="reports-chevron-down" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="reports-form-questions-content" style="display: none;">
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">How old are you?</div>
                                            <div class="reports-question-answer">30</div>
                                        </div>
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">Do you have any allergies to medications?</div>
                                            <div class="reports-question-answer">Yes, Penicillin</div>
                                        </div>
                                        <div class="reports-form-question-item">
                                            <div class="reports-question-label">Do you have any family history of any conditions?</div>
                                            <div class="reports-question-answer">None</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Filter Modal -->
<div class="modal fade" id="reportsFilterModal" tabindex="-1" aria-labelledby="reportsFilterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered reports-filter-modal-dialog">
        <div class="modal-content reports-filter-modal-content">
            <div class="modal-body reports-filter-modal-body">
                <!-- Date Range -->
                <div class="reports-modal-filter-group">
                    <label class="reports-modal-filter-label">Date Range</label>
                    <div class="reports-modal-date-input-wrapper">
                        <input type="text" class="form-control reports-modal-date-input" id="modalReportDateFrom" placeholder="From">
                        <svg class="reports-modal-calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="reports-modal-date-input-wrapper">
                        <input type="text" class="form-control reports-modal-date-input" id="modalReportDateTo" placeholder="To">
                        <svg class="reports-modal-calendar-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>

                <!-- Appointment Type -->
                <div class="reports-modal-filter-group">
                    <label class="reports-modal-filter-label">Appointment Type</label>
                    <div class="reports-modal-select-wrapper">
                        <select class="form-select reports-modal-select" id="modalReportAppointmentType">
                            <option value="all" selected>All</option>
                            <option value="consultation">Consultation</option>
                            <option value="medical">Medical Appointment</option>
                        </select>
                    </div>
                </div>

                <!-- Status -->
                <div class="reports-modal-filter-group">
                    <label class="reports-modal-filter-label">Status</label>
                    <div class="reports-modal-select-wrapper reports-modal-status-wrapper">
                        <select class="form-select reports-modal-select reports-modal-status-select" id="modalReportStatus">
                            <option value="cancelled" selected>Cancelled</option>
                            <option value="booked">Booked</option>
                            <option value="completed">Completed</option>
                            <option value="rescheduled">Rescheduled</option>
                        </select>
                    </div>
                </div>

                <!-- Report Type Radio Buttons -->
                <div class="reports-modal-radio-group">
                    <div class="reports-modal-radio-item">
                        <input type="radio" name="modalReportType" id="modalSummaryReport" value="summary">
                        <label for="modalSummaryReport">Summary Report</label>
                    </div>
                    <div class="reports-modal-radio-item">
                        <input type="radio" name="modalReportType" id="modalDetailedReport" value="detailed" checked>
                        <label for="modalDetailedReport">Detailed Report</label>
                    </div>
                </div>

                <!-- Generate Button -->
                <button class="btn reports-modal-generate-btn" onclick="generateReportFromModal()">Generate</button>

                <!-- Export to CSV Link -->
                <a href="#" class="reports-modal-export-link" onclick="exportToCSV()">Export to CSV</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle Form Questions visibility
        function toggleFormQuestions(header) {
            const formQuestionsDiv = header.closest('.reports-form-questions');
            const content = formQuestionsDiv.querySelector('.reports-form-questions-content');
            const chevron = header.querySelector('svg');
            
            if (content.style.display === 'none') {
                content.style.display = 'grid';
                chevron.innerHTML = '<path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
                chevron.classList.remove('reports-chevron-down');
                chevron.classList.add('reports-chevron-up');
            } else {
                content.style.display = 'none';
                chevron.innerHTML = '<path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
                chevron.classList.remove('reports-chevron-up');
                chevron.classList.add('reports-chevron-down');
            }
        }

        // Toggle Form Questions visibility based on Report Type (Summary/Detailed)
        function toggleFormQuestionsByReportType() {
            const isSummary = document.getElementById('summaryReport').checked;
            const formQuestionRows = document.querySelectorAll('.reports-form-questions-row');
            
            formQuestionRows.forEach(row => {
                if (isSummary) {
                    row.style.display = 'none';
                } else {
                    row.style.display = 'table-row';
                }
            });
        }

        // Generate Report
        function generateReport() {
            // Get filter values
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            const appointmentType = document.getElementById('reportAppointmentType').value;
            const status = document.getElementById('reportStatus').value;
            const reportType = document.querySelector('input[name="reportType"]:checked').value;

            // Update top filters display
            const topFilters = document.querySelector('.reports-top-filters');
            if (topFilters) {
                const typeDisplay = topFilters.querySelector('.reports-top-filter-group:nth-child(1) .reports-top-filter-value');
                const statusDisplay = topFilters.querySelector('.reports-top-filter-group:nth-child(2) .reports-top-filter-value');
                const dateDisplay = topFilters.querySelector('.reports-date-range-display .reports-top-filter-value');
                
                if (typeDisplay) typeDisplay.textContent = appointmentType === 'all' ? 'All' : appointmentType;
                if (statusDisplay) statusDisplay.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                if (dateDisplay && dateFrom && dateTo) dateDisplay.textContent = `${dateFrom} - ${dateTo}`;
            }

            console.log('Generating report with:', { dateFrom, dateTo, appointmentType, status, reportType });
        }

        // Export to CSV
        function exportToCSV() {
            console.log('Exporting to CSV...');
            // Implementation for CSV export
        }

        // Generate Report from Mobile Modal
        function generateReportFromModal() {
            // Get filter values from modal
            const dateFrom = document.getElementById('modalReportDateFrom').value;
            const dateTo = document.getElementById('modalReportDateTo').value;
            const appointmentType = document.getElementById('modalReportAppointmentType').value;
            const status = document.getElementById('modalReportStatus').value;
            const reportType = document.querySelector('input[name="modalReportType"]:checked').value;

            // Sync values to desktop form
            document.getElementById('reportDateFrom').value = dateFrom;
            document.getElementById('reportDateTo').value = dateTo;
            document.getElementById('reportAppointmentType').value = appointmentType;
            document.getElementById('reportStatus').value = status;
            if (reportType === 'summary') {
                document.getElementById('summaryReport').checked = true;
            } else {
                document.getElementById('detailedReport').checked = true;
            }

            // Update mobile filter tags
            const typeTag = document.getElementById('mobileFilterTypeTag');
            const statusTag = document.getElementById('mobileFilterStatusTag');
            const dateTag = document.getElementById('mobileFilterDateTag');

            if (typeTag) typeTag.textContent = appointmentType === 'all' ? 'All' : appointmentType;
            if (statusTag) statusTag.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            if (dateTag && dateFrom && dateTo) dateTag.textContent = `${dateFrom} - ${dateTo}`;

            // Update desktop top filters display
            const topFilters = document.querySelector('.reports-top-filters');
            if (topFilters) {
                const typeDisplay = topFilters.querySelector('.reports-top-filter-group:nth-child(1) .reports-top-filter-value');
                const statusDisplay = topFilters.querySelector('.reports-top-filter-group:nth-child(2) .reports-top-filter-value');
                const dateDisplay = topFilters.querySelector('.reports-date-range-display .reports-top-filter-value');
                
                if (typeDisplay) typeDisplay.textContent = appointmentType === 'all' ? 'All' : appointmentType;
                if (statusDisplay) statusDisplay.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                if (dateDisplay && dateFrom && dateTo) dateDisplay.textContent = `${dateFrom} - ${dateTo}`;
            }

            // Toggle form questions based on report type
            toggleFormQuestionsByReportType();

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('reportsFilterModal'));
            if (modal) modal.hide();

            console.log('Generating report from modal with:', { dateFrom, dateTo, appointmentType, status, reportType });
        }

        // Initialize date pickers
        document.addEventListener('DOMContentLoaded', function() {
            // You can add date picker initialization here if needed
        });
    </script>
}
