<!-- Payment Method View - Simplified Two Column Layout -->
<div id="payment-method-view" class="payment-method-view-v2">
    <!-- Mobile Items Page (First Page) -->
    <div id="mobile-items-page-v2" class="d-md-none">
        <div class="d-flex align-items-center justify-content-center mb-4 position-relative mobile-header-container">
            <button class="btn btn-link p-0 back-link text-decoration-none position-absolute start-0" onclick="backToServiceCategoryFromPayment()">
                <i class="bi bi-chevron-left mobile-back-chevron"></i>
            </button>
            <h2 class="fs-24 ff-default font-darkgray fw-400 mb-0">Items</h2>
        </div>

        <div class="payment-items-list">
            <!-- Item 1 -->
            <div class="payment-item-card mb-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="item-details">
                        <h5 class="item-name mb-2">Eyebrow Threading</h5>
                        <p class="item-info text-muted mb-1">SM Megamall- Face</p>
                        <p class="item-info text-muted mb-1">March 4, 2025 (Tuesday)</p>
                        <p class="item-info text-muted mb-0">9:00 - 9:50 AM GMT+8</p>
                    </div>
                    <div class="item-pricing text-end">
                        <div class="item-price fw-bold">₱190.00</div>
                        <div class="item-original-price text-muted small">₱300.00</div>
                    </div>
                </div>
            </div>

            <!-- Item 2 -->
            <div class="payment-item-card mb-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="item-details">
                        <h5 class="item-name mb-2">Eyelash Lift</h5>
                        <p class="item-info text-muted mb-1">SM Megamall- Face</p>
                        <p class="item-info text-muted mb-1">March 4, 2025 (Tuesday)</p>
                        <p class="item-info text-muted mb-0">10:00 - 10:30 AM GMT+8</p>
                    </div>
                    <div class="item-pricing text-end">
                        <div class="item-price fw-bold">₱500.00</div>
                        <div class="item-original-price text-muted small">₱1500.00</div>
                    </div>
                </div>
            </div>

            <!-- Total Section -->
            <div class="payment-totals mt-3 pt-3">
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Total Amount <small>(full payment)</small></span>
                    <span class="fw-semibold" id="mobile-full-amount">₱1800.00</span>
                </div>
                <div class="d-flex justify-content-between mb-3" id="mobile-due-amount-row">
                    <span class="fw-bold">Total Amount Due <small>(new, fee)</small></span>
                    <span class="fw-bold" id="mobile-due-amount">₱690.00</span>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="payFullAmount" onclick="togglePaymentAmount('mobile')" onchange="togglePaymentAmount('mobile')">
                    <label class="form-check-label text-muted" style="font-size: 0.8rem;" for="payFullAmount">
                        I want to pay the total amount
                    </label>
                </div>
            </div>
        </div>

        <!-- Mobile Continue Button (Fixed at bottom) -->
        <div class="mobile-items-continue-container">
            <button type="button" class="btn btn-primary py-3 w-100 d-flex justify-content-between align-items-center" onclick="showMobilePaymentPageV2()">
                <span>Continue</span>
                <span class="fw-bold" id="mobile-button-amount">₱690.00</span>
            </button>
        </div>
    </div>

    <!-- Mobile Payment Providers Page (Second Page) -->
    <div id="mobile-payment-page-v2" class="d-md-none" style="display: none;">
        <div class="d-flex align-items-center justify-content-center mb-3 position-relative mobile-header-container">
            <button class="btn btn-link p-0 back-link text-decoration-none position-absolute start-0" onclick="showMobileItemsPageV2()">
                <i class="bi bi-chevron-left mobile-back-chevron"></i>
            </button>
            <h2 class="fs-24 ff-default font-darkgray fw-400 mb-0">Payment Providers</h2>
        </div>

        <p class="text-muted small mb-4">You'll be redirected to you selected payment provider to complete your booking securely.</p>

        <div class="payment-providers-list">
            <div class="payment-providers-box p-4 mb-4">
                <!-- Paymongo -->
                <div class="payment-provider-item d-flex align-items-center pb-3">
                    <input type="radio" name="payment-provider-mobile" id="provider-paymongo-mobile" value="paymongo" class="form-check-input me-3" checked>
                    <label for="provider-paymongo-mobile" class="form-check-label d-flex align-items-center justify-content-between flex-grow-1 mb-0">
                        <span class="provider-name">Paymongo</span>
                        <span class="badge bg-danger rounded-pill">Default</span>
                    </label>
                </div>
                <hr class="payment-separator">

                <!-- Maya Business -->
                <div class="payment-provider-item d-flex align-items-center pb-3 pt-3">
                    <input type="radio" name="payment-provider-mobile" id="provider-maya-mobile" value="maya" class="form-check-input me-3">
                    <label for="provider-maya-mobile" class="form-check-label flex-grow-1 mb-0">
                        <span class="provider-name">Maya Business</span>
                    </label>
                </div>
                <hr class="payment-separator">

                <!-- Paypal -->
                <div class="payment-provider-item d-flex align-items-center pt-3">
                    <input type="radio" name="payment-provider-mobile" id="provider-paypal-mobile" value="paypal" class="form-check-input me-3">
                    <label for="provider-paypal-mobile" class="form-check-label flex-grow-1 mb-0">
                        <span class="provider-name">Paypal</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Continue Button -->
        <div class="mobile-payment-continue-container">
            <button type="button" class="btn btn-primary py-3 w-100 d-flex justify-content-between align-items-center" onclick="proceedToPaymentMobile()">
                <span>Continue to Payment</span>
                <span class="fw-bold" id="mobile-payment-button-amount">₱690.00</span>
            </button>
        </div>
    </div>

    <!-- Desktop View (Two Column Layout) - ONLY VISIBLE ON DESKTOP -->
    <div class="desktop-only-view d-none d-md-block">
        <div class="container-fluid">
            <!-- Back Button and Titles Row -->
            <div class="d-flex align-items-center mb-4">
                <button class="btn btn-link p-0 back-link text-decoration-none me-4" onclick="backToServiceCategoryFromPayment()">
                    <i class="bi bi-chevron-left"></i>
                    <span class="text-orange fs-14">Back</span>
                </button>
                <div class="payment-titles-row flex-grow-1">
                    <div class="payment-title-left">
                        <h2 class="section-title-payment-method2">Items</h2>
                    </div>
                    <div class="payment-title-spacer"></div>
                    <div class="payment-title-right">
                        <h2 class="section-title-payment-method2">Payment Providers</h2>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Left Column - Items -->
                <div class="col-md-6 payment-items-column">
                    <div class="payment-items-list">
                        <!-- Item 1 -->
                        <div class="payment-item-card mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="item-details">
                                    <h5 class="item-name mb-2">Eyebrow Threading</h5>
                                    <p class="item-info text-muted mb-1">SM Megamall- Face</p>
                                    <p class="item-info text-muted mb-1">March 4, 2025 (Tuesday)</p>
                                    <p class="item-info text-muted mb-0">9:00 - 9:50 AM GMT+8</p>
                                </div>
                                <div class="item-pricing text-end">
                                    <div class="item-price fw-bold">₱190.00</div>
                                    <div class="item-original-price text-muted small">₱300.00</div>
                                </div>
                            </div>
                        </div>

                        <!-- Item 2 -->
                        <div class="payment-item-card mb-4">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="item-details">
                                    <h5 class="item-name mb-2">Eyelash Lift</h5>
                                    <p class="item-info text-muted mb-1">SM Megamall- Face</p>
                                    <p class="item-info text-muted mb-1">March 4, 2025 (Tuesday)</p>
                                    <p class="item-info text-muted mb-0">10:00 - 10:30 AM GMT+8</p>
                                </div>
                                <div class="item-pricing text-end">
                                    <div class="item-price fw-bold">₱500.00</div>
                                    <div class="item-original-price text-muted small">₱1500.00</div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Section -->
                        <div class="payment-totals mt-3 pt-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Total Amount <small>(full payment)</small></span>
                                <span class="fw-semibold" id="desktop-full-amount">₱1800.00</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3" id="desktop-due-amount-row">
                                <span class="fw-bold">Total Amount Due <small>(new, fee)</small></span>
                                <span class="fw-bold" id="desktop-due-amount">₱690.00</span>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="payFullAmountDesktop" onclick="togglePaymentAmount('desktop')" onchange="togglePaymentAmount('desktop')">
                                <label class="form-check-label text-muted" style="font-size: 0.8rem;" for="payFullAmountDesktop">
                                    I want to pay the total amount
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Payment Providers -->
                <div class="col-md-6 payment-providers-column">
                    <p class="text-muted small mb-4">You'll be redirected to you selected payment provider to complete your booking securely.</p>

                    <div class="payment-providers-list">
                        <div class="payment-providers-box p-4 mb-4">
                            <!-- Paymongo -->
                            <div class="payment-provider-item d-flex align-items-center pb-3">
                                <input type="radio" name="payment-provider" id="provider-paymongo" value="paymongo" class="form-check-input me-3" checked>
                                <label for="provider-paymongo" class="form-check-label d-flex align-items-center justify-content-between flex-grow-1 mb-0">
                                    <span class="provider-name">Paymongo</span>
                                    <span class="badge bg-danger rounded-pill">Default</span>
                                </label>
                            </div>
                            <hr class="payment-separator">

                            <!-- Maya Business -->
                            <div class="payment-provider-item d-flex align-items-center pb-3 pt-3">
                                <input type="radio" name="payment-provider" id="provider-maya" value="maya" class="form-check-input me-3">
                                <label for="provider-maya" class="form-check-label flex-grow-1 mb-0">
                                    <span class="provider-name">Maya Business</span>
                                </label>
                            </div>
                            <hr class="payment-separator">

                            <!-- Paypal -->
                            <div class="payment-provider-item d-flex align-items-center pt-3">
                                <input type="radio" name="payment-provider" id="provider-paypal" value="paypal" class="form-check-input me-3">
                                <label for="provider-paypal" class="form-check-label flex-grow-1 mb-0">
                                    <span class="provider-name">Paypal</span>
                                </label>
                            </div>
                        </div>

                        <!-- Continue to Payment Button -->
                        <div class="payment-action-container">
                            <button type="button" class="btn btn-primary btn-lg w-100 py-3" onclick="proceedToPayment()">
                                Continue to Payment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Payment Method V2 Styles */
.payment-method-view-v2 {
 
    max-width: 1400px;
    margin: 0 auto;
}

.payment-titles-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.payment-title-left,
.payment-title-right {
    flex: 1;
}

.payment-title-spacer {
    width: 2rem;
}

.payment-items-column,
.payment-providers-column {
    padding: 0 1.5rem;
    min-height: 600px;
}

.payment-items-column {
    position: relative;
}

.payment-items-column::after {
    content: '';
    position: absolute;
    right: 0;
    top: -120px;
    bottom: 0;
    width: 1px;
    background-color: #e0e0e0;
}

.section-title-payment-method2 {
    font-size: 1.5rem;
    font-weight: 400;
    color: #6c757d;
    margin-bottom: 30px;
}

.back-link {
    color: #ff6b35;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.back-link:hover {
    color: #ff8555;
}

/* Items Styling */
.payment-item-card {
    padding: 1rem 0;
    background: transparent;
    border: none;
    border-bottom: 1px solid #f0f0f0;
}

.payment-item-card:last-of-type {
    border-bottom: none;
}

.item-name {
    font-size: 1rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.item-info {
    font-size: 0.875rem;
    line-height: 1.4;
    color: #999;
}

.item-price {
    color: #333;
    font-size: 0.9rem;
}

.item-original-price {
    font-size: 0.75rem;
    color: #999;
}

.payment-totals {
    padding: 1rem 0 0 0;
    margin-top: 0.75rem;
}

.hidden-row {
    display: none !important;
}

/* Payment Provider Styling */
.payment-providers-box {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
}

.payment-provider-item {
    cursor: pointer;
}

.payment-provider-item .form-check-input {
    width: 20px;
    height: 20px;
    border: 2px solid #d0d0d0;
    cursor: pointer;
    margin-top: 0;
    flex-shrink: 0;
}

.payment-provider-item .form-check-input:checked {
    background-color: #ff6b35;
    border-color: #ff6b35;
}

.payment-provider-item .form-check-label {
    cursor: pointer;
    font-size: 1rem;
}

.provider-name {
    font-size: 1rem;
    font-weight: 400;
    color: #333;
}

.badge.bg-danger {
    background-color: #ff6b35 !important;
    font-size: 0.75rem;
    padding: 0.25rem 0.6rem;
    font-weight: 500;
}

.payment-provider-item.border-bottom {
    border-color: #e0e0e0 !important;
}

.payment-separator {
    margin-left: -1.5rem;
    margin-right: -1.5rem;
    margin-top: 0;
    margin-bottom: 0;
    border: 0;
    border-top: 1px solid #e0e0e0;
    opacity: 1;
}

.btn-primary {
    background-color: #ff6b35;
    border-color: #ff6b35;
    font-size: 1.1rem;
    font-weight: 500;
}

.btn-primary:hover {
    background-color: #ff8555;
    border-color: #ff8555;
}

/* Mobile Header Styles */
.mobile-header-container {
    padding: 0 1rem;
}

.mobile-back-chevron {
    font-size: 1.5rem;
    color: #ff6b35;
}

/* Mobile Continue Button Styles */
.mobile-items-continue-container,
.mobile-payment-continue-container {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    background: #fff;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
}

/* Add padding to mobile pages to prevent content from being hidden behind fixed button */
#mobile-items-page-v2,
#mobile-payment-page-v2 {
    padding: 1rem;
    padding-bottom: 100px;
}

/* Responsive Design */
@@media (max-width: 768px) {
    .payment-method-view-v2 {
        padding: 0;
    }

    /* FORCE HIDE desktop view on mobile - use multiple selectors */
    .desktop-view,
    .desktop-view-actual,
    .desktop-only-view {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        overflow: hidden !important;
    }

    /* Adjust item cards for mobile */
    .payment-item-card {
        padding: 1rem 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .item-name {
        font-size: 0.95rem;
        font-weight: 600;
    }

    .item-info {
        font-size: 0.8rem;
    }

    .item-price {
        font-size: 0.9rem;
    }

    .item-original-price {
        font-size: 0.7rem;
    }

    /* Adjust payment totals */
    .payment-totals {
        font-size: 0.85rem;
    }

    .payment-totals .fw-semibold,
    .payment-totals .fw-bold {
        font-size: 0.95rem !important;
    }

    /* Adjust payment providers box */
    .payment-providers-box {
        padding: 1rem !important;
        border-radius: 8px;
    }

    .payment-separator {
        margin-left: -1rem;
        margin-right: -1rem;
    }

    .provider-name {
        font-size: 0.95rem;
    }

    .payment-provider-item .form-check-input {
        width: 20px;
        height: 20px;
    }

    /* Adjust button */
    .btn-primary {
        font-size: 1rem;
        border-radius: 8px;
    }
}

@@media (max-width: 576px) {
    #mobile-items-page-v2,
    #mobile-payment-page-v2 {
        padding: 0.75rem;
        padding-bottom: 100px;
    }

    .item-details {
        flex: 1;
        padding-right: 0.5rem;
    }

    .item-pricing {
        min-width: 90px;
    }

    .mobile-header-container {
        padding: 0 0.5rem;
    }
}
</style>

<script>
// Mobile navigation functions
function showMobilePaymentPageV2() {
    document.getElementById('mobile-items-page-v2').style.display = 'none';
    document.getElementById('mobile-payment-page-v2').style.display = 'block';
    window.scrollTo(0, 0);
}

function showMobileItemsPageV2() {
    document.getElementById('mobile-payment-page-v2').style.display = 'none';
    document.getElementById('mobile-items-page-v2').style.display = 'block';
    window.scrollTo(0, 0);
}

// Mobile payment processing
function proceedToPaymentMobile() {
    const selectedProvider = document.querySelector('input[name="payment-provider-mobile"]:checked');
    
    if (!selectedProvider) {
        alert('Please select a payment provider');
        return;
    }

    const provider = selectedProvider.value;
    console.log('Proceeding with payment provider:', provider);
    
    // Reset cart and information state after successful payment
    hasCompletedInformation = false;
    cart = [];
    updateCartDisplay();
    
    // Navigate to confirmation page
    window.location.href = '/Scheduler/user_view/Confirmed';
}

// Desktop payment processing
function proceedToPayment() {
    const selectedProvider = document.querySelector('input[name="payment-provider"]:checked');
    
    if (!selectedProvider) {
        alert('Please select a payment provider');
        return;
    }

    const provider = selectedProvider.value;
    console.log('Proceeding with payment provider:', provider);
    
    // Reset cart and information state after successful payment
    hasCompletedInformation = false;
    cart = [];
    updateCartDisplay();
    
    // Navigate to confirmation page
    window.location.href = '/Scheduler/user_view/Confirmed';
}

function backToServiceCategoryFromPayment() {
    // Navigate back to service category selection
    const paymentMethodView = document.getElementById('payment-method-view');
    if (paymentMethodView) {
        paymentMethodView.style.display = 'none';
        paymentMethodView.classList.add('display-none');
    }
    
    const serviceCategorySelection = document.getElementById('service-category-selection');
    if (serviceCategorySelection) {
        serviceCategorySelection.style.display = 'block';
        serviceCategorySelection.classList.remove('display-none');
    }
    
    window.scrollTo(0, 0);
}

// Toggle payment amount when checkbox is clicked
function togglePaymentAmount(view) {
    const fullAmount = '₱1800.00';
    const dueAmount = '₱690.00';
    
    console.log('togglePaymentAmount called with view:', view);
    
    if (view === 'mobile') {
        const checkbox = document.getElementById('payFullAmount');
        const dueAmountRow = document.getElementById('mobile-due-amount-row');
        const fullAmountSpan = document.getElementById('mobile-full-amount');
        const buttonAmount = document.getElementById('mobile-button-amount');
        const paymentButtonAmount = document.getElementById('mobile-payment-button-amount');
        
        console.log('Checkbox checked:', checkbox ? checkbox.checked : 'checkbox not found');
        console.log('Due amount row found:', !!dueAmountRow);
        
        if (checkbox && dueAmountRow && fullAmountSpan) {
            if (checkbox.checked) {
                // Hide the "Total Amount Due" row using class
                dueAmountRow.classList.add('hidden-row');
                dueAmountRow.style.display = 'none';
                // Make full amount bold and same size as due amount was
                fullAmountSpan.classList.remove('fw-semibold');
                fullAmountSpan.classList.add('fw-bold');
                // Update button amounts to full amount
                if (buttonAmount) buttonAmount.textContent = fullAmount;
                if (paymentButtonAmount) paymentButtonAmount.textContent = fullAmount;
                console.log('Checkbox checked - hiding due amount row');
            } else {
                // Show the "Total Amount Due" row
                dueAmountRow.classList.remove('hidden-row');
                dueAmountRow.style.display = 'flex';
                // Restore original styling
                fullAmountSpan.classList.remove('fw-bold');
                fullAmountSpan.classList.add('fw-semibold');
                // Update button amounts to due amount
                if (buttonAmount) buttonAmount.textContent = dueAmount;
                if (paymentButtonAmount) paymentButtonAmount.textContent = dueAmount;
                console.log('Checkbox unchecked - showing due amount row');
            }
        } else {
            console.error('Required elements not found:', {
                checkbox: !!checkbox,
                dueAmountRow: !!dueAmountRow,
                fullAmountSpan: !!fullAmountSpan
            });
        }
    } else if (view === 'desktop') {
        const checkbox = document.getElementById('payFullAmountDesktop');
        const dueAmountRow = document.getElementById('desktop-due-amount-row');
        const fullAmountSpan = document.getElementById('desktop-full-amount');
        
        console.log('Desktop checkbox checked:', checkbox ? checkbox.checked : 'checkbox not found');
        
        if (checkbox && dueAmountRow && fullAmountSpan) {
            if (checkbox.checked) {
                // Hide the "Total Amount Due" row using class
                dueAmountRow.classList.add('hidden-row');
                dueAmountRow.style.display = 'none';
                // Make full amount bold and same size as due amount was
                fullAmountSpan.classList.remove('fw-semibold');
                fullAmountSpan.classList.add('fw-bold');
                console.log('Desktop checkbox checked - hiding due amount row');
            } else {
                // Show the "Total Amount Due" row
                dueAmountRow.classList.remove('hidden-row');
                dueAmountRow.style.display = 'flex';
                // Restore original styling
                fullAmountSpan.classList.remove('fw-bold');
                fullAmountSpan.classList.add('fw-semibold');
                console.log('Desktop checkbox unchecked - showing due amount row');
            }
        } else {
            console.error('Required desktop elements not found:', {
                checkbox: !!checkbox,
                dueAmountRow: !!dueAmountRow,
                fullAmountSpan: !!fullAmountSpan
            });
        }
    }
}
</script>
